- content_for :head do
  %meta{ property: "og:title", content: @reel.name }
  %meta{ property: "og:type", content: "website" }
  %meta{ property: "og:url", content: reel_url(@reel) }
  - if @reel.media.any?
    - if @reel.media.last.is_a? Video
      %meta{property: "og:image", content: "http://img.youtube.com/vi/#{@reel.media.last.uid}/0.jpg" }
      %meta{property: "og:video", content: "http://www.youtube.com/v/#{@reel.media.last.uid}"}
    - elsif @reel.media.last.is_a? Image
      %meta{property: "og:image", content: URI.join(request.url, @reel.images.last.photo.url)}
  %meta{ property: "og:description", content: reel_description }
  %meta{ name: "twitter:card", content: "summary_large_image" }
  %meta{ name: "twitter:site", content: "@Evrystep" }
  %meta{ name: "twitter:title", content: "Evrystep Reel" }
  %meta{ name: "twitter:description", content: reel_description }
  %meta{ name: "twitter:image", content: reel_image }
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
- media = @images.zip(@videos).flatten.compact
%div#fb-root{"data-fb-app-id" => ENV['FACEBOOK_APP_ID']}
= render 'shared/nav'
-if current_user && current_user.id == @user.id
  = render 'shared/modal_edit'
  = render 'shared/modal_add_credit'
.reel-page
  .reel-header-container
    .container
      .row.hero
        .col-sm-2
          .avatar-container
            = link_to user_path(@reel.user) do
              .avatar{:style => "background-image: url(#{@user.avatar.url});"}
            %br
            %small.reel-artist-name
              %i
                by
                %b
                  = link_to @user.first_name + " " + @user.last_name, user_path(@reel.user)
            %small.reel-artist-name
              %i.fa.fa-info-circle
              %span
                = @user.description
            %small.reel-artist-name
              %i.fa.fa-map-marker
              %span
                = @user.location
            %br
        .col-sm-9.reel-header
          .reel-top-header
            - interest = @reel.interests
            - length = interest.length
            %ul.list-inline.m-bottom-10
              - interest.each_with_index do |interest, x|
                - if x+1 != length
                  %li.interest-tags
                    %i.fa.fa-tag
                    %span
                      = link_to(interest.name, "/interests/#{interest.id}")
                  /%li.divider
                - else
                  %li.interest-tags
                    %i.fa.fa-tag
                    %span
                      = link_to(interest.name, "/interests/#{interest.id}")
          -if @reel.featured?
            .featured-reel-tag
              %span.featured-tag Featured!
          %h3.reel-name-header.m-bottom-5.m-top-10
            = @reel.name
            - if current_user && current_user.id == @user.id
              = link_to edit_reel_path(@reel) do
                %i.fa.fa-pencil-square
                Edit
          .share-button-mobile
            .share-line
            .share-triangle
            .share-triangle-right
            .share-circle.text-center
              %i.fa.fa-share-alt
              Share!
          %h5.reel-description
            %i.fa.fa-eye
            #{@reel.impressionist_count} views
            &nbsp;
            %i.fa.fa-image
            #{@reel.media.count} media
          %p.reel-description= @reel.description
  .reel-sticky-cta-bg
    .reel-sticky-cta.container#reel-sticky-anchor
      .share-button
        .share-line
        .share-triangle
        .share-circle.text-center
          %i.fa.fa-share-alt
          Share!
        #links
          .link-item
            %a.share.twitter-share-button{href: "https://twitter.com/share"}
      %ul.list-inline.reel-view-options
        %li.reel-view-item{:style => "border-bottom: medium solid rgb(16, 187, 167)"}
          %i.fa.fa-list
          %p Timeline
        %li.reel-view-item
          %i.fa.fa-th-large
          %p Grid
        %li.reel-view-item.dropdown
          .dropdown-toggle#credits{"type" => "button", "data-toggle" => "dropdown", "aria-haspopup" => "true", "aria-expanded" => "true"}
            %i.fa.fa-group
            %p Credits
          %ul.reel-credit-list.dropdown-menu{"aria-labelledby" => "credits"}
            - if current_user && current_user.id == @user.id
              %a.add-credit-button{"data-toggle" => "modal", "data-target" => "#add-credit-modal"}
                %i.fa.fa-plus-circle
                Add Credit to the Reel
            - if current_user && current_user.id != @user.id
              - if @credits.length == 0
                %p= '"' + @reel.name + '" has no credits yet.'
            - @credits.each do |credit|
              - if current_user && current_user.id == @user.id
                - if credit.accepted_invitation == false
                  %li.reel-credit-item.reel-credit-pending
                    %p.reel-credit-role= credit.role.upcase
                    - if credit.credit_receiver_id == nil
                      %strong= credit.credit_receiver_email + " (pending)"
                    - else
                      - @all_user.each do |user|
                        - if user.id == credit.credit_receiver_id
                          = link_to user_path(user) do
                            %img.credit-avatar{:style => "background-image: url(#{user.avatar.url});"}
                          %strong= link_to user.first_name + " " + user.last_name + " (pending)", user_path(user)
              - if credit.accepted_invitation
                %li.reel-credit-item
                  %p.reel-credit-role= credit.role.upcase
                  - if credit.credit_receiver_id == nil
                    %strong= credit.credit_receiver_email
                  - else
                    - @all_user.each do |user|
                      - if user.id == credit.credit_receiver_id
                        = link_to user_path(user) do
                          %img.credit-avatar{:style => "background-image: url(#{user.avatar.url});"}
                        %strong= link_to user.first_name + " " + user.last_name, user_path(user)
  -# .link-bar
  -#   .container
  -#     .row-fluid
  -#       .col-md-5.user
  -#         = link_to user_path(@reel.user) do
  -#           .avatar{:style => "background-image: url(#{@user.avatar.url});"}
  -#           %h5= @user.first_name + " " + @user.last_name
  -#       .col-md-5.views
  -#         %h4.p-top-10.pull-left #{@reel.impressionist_count} views
  -#         .links
  -#           .share.fb-share-button{"data-href" => reel_url(@reel), "data-layout" => "button"}
  -#           %a.share.twitter-share-button{href: "https://twitter.com/share"} Tweet
  -#       .col-md-2.edit
  -#         - if current_user && current_user.id == @user.id
  -#           = link_to "Edit Reel", edit_reel_path(@reel), class: "btn btn-default edit-reel"
  = render 'shared/timeline'
